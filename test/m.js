const BigNumber = require("bignumber.js");

const p = new BigNumber("21888242871839275222246405745257275088548364400416034343698204186575808495617");
const c = [
    new BigNumber("0"),
    new BigNumber("25823191961023811529686723375255045606187170120624741056268890390838310270028"),
    new BigNumber("71153255768872006974285801937521995907343848376936063113800887806988124358800"),
    new BigNumber("51253176922899201987938365653129780755804051536550826601168630951148399005246"),
    new BigNumber("66651710483985382365580181188706173532487386392003341306307921015066514594406"),
    new BigNumber("45887003413921204775397977044284378920236104620216194900669591190628189327887"),
    new BigNumber("14399999722617037892747232478295923748665564430258345135947757381904956977453"),
    new BigNumber("29376176727758177809204424209125257629638239807319618360680345079470240949145"),
    new BigNumber("13768859312518298840937540532277016512087005174650120937309279832230513110846"),
    new BigNumber("54749662990362840569021981534456448557155682756506853240029023635346061661615"),
    new BigNumber("25161436470718351277017231215227846535148280460947816286575563945185127975034"),
    new BigNumber("90370030464179443930112165274275271350651484239155016554738639197417116558730"),
    new BigNumber("92014788260850167582827910417652439562305280453223492851660096740204889381255"),
    new BigNumber("40376490640073034398204558905403523738912091909516510156577526370637723469243"),
    new BigNumber("903792244391531377123276432892896247924738784402045372115602887103675299839"),
    new BigNumber("112203415202699791888928570309186854585561656615192232544262649073999791317171"),
    new BigNumber("114801681136748880679062548782792743842998635558909635247841799223004802934045"),
    new BigNumber("111440818948676816539978930514468038603327388809824089593328295503672011604028"),
    new BigNumber("64965960071752809090438003157362764845283225351402746675238539375404528707397"),
    new BigNumber("98428510787134995495896453413714864789970336245473413374424598985988309743097"),
    // Add remaining constants from the contract here...
];

function addmod(a, b, mod) {
    return a.plus(b).mod(mod);
}

function mulmod(a, b, mod) {
    return a.multipliedBy(b).mod(mod);
}

function MiMC5Feistel(iL, iR, k) {
    const nRounds = 20; // Number of rounds
    let lastL = new BigNumber(iL);
    let lastR = new BigNumber(iR);

    for (let i = 0; i < nRounds; i++) {
        let mask = addmod(lastR, k, p);
        mask = addmod(mask, c[i], p);

        let mask2 = mulmod(mask, mask, p);
        let mask4 = mulmod(mask2, mask2, p);
        mask = mulmod(mask4, mask, p);

        const temp = lastR;
        lastR = addmod(lastL, mask, p);
        lastL = temp;
    }

    return [lastL, lastR];
}

function MiMC5Sponge(inputs, k) {
    let lastR = new BigNumber(0);
    let lastC = new BigNumber(0);

    inputs.forEach(input => {
        lastR = addmod(lastR, new BigNumber(input), p);
        [lastR, lastC] = MiMC5Feistel(lastR, lastC, new BigNumber(k));
    });

    return lastR.toFixed();
}

// Example usage
const left = 12345; // Replace with actual values
const right = 67890;
const commitment = 112233; // Replace with actual commitment

const inputs = [left, right];
const hash = MiMC5Sponge(inputs, commitment);

console.log("Hash of nodes:", hash);

